<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Store API</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="../node_modules/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        header{
            background-color: red;
            height: 50px;
            color: white;
            text-align: center;
        }
    </style>

    <script>

          function getCategory(){
            fetch("https://fakestoreapi.com/products/categories")
            .then(function(response){
                return response.json();
            })
            .then(function(data){
                data.unshift("ALL");//to add ALL at beigging of the arrray
                for(var item of data){
                    var option=document.createElement("option");
                    option.innerHTML=item.toUpperCase();
                    option.value=item;
                    
                    document.querySelector("select").appendChild(option);
                }
            })
          }

          function getProducts(url){
            document.querySelector(".card_group").innerHTML="";

            fetch(url)
            .then(function(response){
                return response.json();
            })
            .then(function(data){
                for(var item of data){
                    var div=document.createElement("div");
                    div.className="card container-fluid w-25 m-3" ;
                    div.style.height="570px";
                    div.style.width="250px";

                    var img=document.createElement("img");
                    img.style.height="200px";
                    img.style.width="200px";
                    img.src=item.image;

                    div.innerHTML=`
                         <div class="card-header">
                            <img src="${item.image}" alt="image" height="200px" width="200px">             
                         </div>

                         <div class="card-body">
                            <h4>${item.title}</h4>
                            
                            <h5>&#8377;${item.price}</h5>
                            <h6>Rate:${item.rating.rate}&nbsp;&nbsp;Count:${item.rating.count}</h6>
                          </div>

                         <div class="card-footer">
                            <button onclick="AddItemtoCart(${item.id})" class="btn btn-danger">Add to Cart</button>
                         </div>

                    `;
                    document.querySelector(".card_group").appendChild(div);
                }
            })
          }

          function changeCategory(){
               var categories=document.getElementById("category").value;
               if(categories=="ALL"){
                   getProducts("https://fakestoreapi.com/products");
               }else{
                   getProducts(`https://fakestoreapi.com/products/category/${categories}`);
               }
          }

          function bodyload(){
            getCategory();
            getProducts("https://fakestoreapi.com/products");
            cartItemCount();
          }

          var cartItems=[];
          var count=0;

          function cartItemCount(){
            count=cartItems.length;
            document.querySelector("#cartCount").innerHTML=count;
          }

          function AddItemtoCart(id){
            fetch(`https://fakestoreapi.com/products/${id}`)
            .then(function(response){
                return response.json();
            })
            .then(function(data){
                cartItems.push(data);
                alert("Item Added to Cart");
                cartItemCount();
            })
          }

          function showCartItems(){
            const tbody = document.querySelector("tbody");
            tbody.innerHTML = ""; // Clear existing rows

            for(var product of cartItems){
                var tr=document.createElement("tr");

                var tdTitle=document.createElement("td");
                var tdPrice=document.createElement("td");
                var tdPhoto=document.createElement("td");

                var img=document.createElement("img");
                img.style.height="100px";
                img.style.width="100px";
                img.src=product.image;

                tdTitle.innerHTML=product.title;
                tdPrice.innerHTML=product.price;
                tdPhoto.appendChild(img);

                tr.appendChild(tdTitle);
                tr.appendChild(tdPrice);
                tr.appendChild(tdPhoto);

                document.querySelector("tbody").appendChild(tr);
            }
          }


    </script>
</head>
<body onload="bodyload()">
    <header>
          <h1 class="bi bi-cart4">&nbsp;Fake Store API</h1>
    </header>
    <div class="row">
        <div class="col-2">
            <select class="form-select-sm mt-5" onchange="changeCategory()" id="category"></select>
        </div>
        <div class="col-8">
            <div class="card_group d-flex flex-wrap">
        
            </div>
        </div>

        <div class="col-2">
                <button onclick="showCartItems()" data-bs-target="#cart" data-bs-toggle="modal" class="btn btn-warning">[<span id="cartCount"></span>]<i class="bi bi-cart3"></i>Your Cart</button>
        </div>
    </div>

  <div class="modal fade" id="cart">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header"><h3>Your Cart Items</h3>
            <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Price</th>
                            <th>Preview</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>

            <div class="modal-footer">
                 <button class="btn btn-success" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
  </div>
    
</body>
</html>